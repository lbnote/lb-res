(function(a,b){if(a.DUOSHUO)return;var c=a.document,d=c.getElementsByTagName("head")[0]||c.getElementsByTagName("body")[0],e=c.createElement("input"),f=a.encodeURI,g=a.encodeURIComponent,h=a.navigator.userAgent,i=0,j=0,k=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},b=/&(?!\w+;)|[<>"'`]/g,c=/[&<>"'`]/,d=function(b){return a[b]||"&amp;"};return function(a){return a==null||a===!1?"":c.test(a)?a.replace(b,d):a}}(),l={start:0,end:0},m=function(a){try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}},n=function(a){var b=0,d=0,e,f,g,h,i;return c.selection&&(f=c.selection.createRange(),f&&f.parentElement()==a&&(h=a.value.length,e=a.value.replace(/\r\n/g,"\n"),g=a.createTextRange(),g.moveToBookmark(f.getBookmark()),i=a.createTextRange(),i.collapse(!1),g.compareEndPoints("StartToEnd",i)>-1?b=d=h:(b=-g.moveStart("character",-h),b+=e.slice(0,b).split("\n").length-1,g.compareEndPoints("EndToEnd",i)>-1?d=h:(d=-g.moveEnd("character",-h),d+=e.slice(0,d).split("\n").length-1)))),l.start=b,l.end=d,{start:b,end:d}},o=function(a){return function(){return a}},p=a.DUOSHUO={DOMAIN:"duoshuo.com",REMOTE:"http://duoshuo.com",STATIC:"http://static.duoshuo.com",EMBED_STYLESHEET:"/styles/embed.css?0.2.css",loaded:{easyXDM:typeof easyXDM=="object",JSON:typeof a.JSON=="object"&&a.JSON,jQuery:typeof jQuery!="undefined"&&jQuery.fn.jquery>="1.5",smilies:!1},libs:{easyXDM:"/libs/easyXDM.min.js",JSON:"/libs/json2.min.js",jQuery:"/libs/embed.compat.js"},sourceName:{weibo:"\u65b0\u6d6a\u5fae\u535a",qq:"QQ",qzone:"QQ\u7a7a\u95f4",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",douban:"\u8c46\u74e3\u7f51",netease:"\u7f51\u6613\u5fae\u535a",kaixin:"\u5f00\u5fc3\u7f51",sohu:"\u641c\u72d0\u5fae\u535a",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",google:"\u8c37\u6b4c"},serviceNames:{weibo:"\u5fae\u535a",qq:"QQ",douban:"\u8c46\u74e3",renren:"\u4eba\u4eba",netease:"\u7f51\u6613",kaixin:"\u5f00\u5fc3",sohu:"\u641c\u72d0",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",google:"\u8c37\u6b4c"},support:{autofocus:"autofocus"in e,placeholder:"placeholder"in e,multiple:"multiple"in e,iOS:h.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:h.match(/ \(Linux; U; Android /)},parseDate:function(a){return a.parse("2011-10-28T00:00:00+08:00")&&function(b){return new a(b)}||a.parse("2011/10/28T00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||a.parse("2011/10/28 00:00:00+0800")&&function(b){return new a(b.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(b){return new a(b)}}(Date),fullTime:function(a){var b=p.parseDate(a);return b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5 "+b.toLocaleTimeString()},elapsedTime:function(a){var b=p.parseDate(a),c=new Date,d=(c-i-b)/1e3;return d<10?"\u521a\u521a":d<60?Math.round(d)+"\u79d2\u524d":d<3600?Math.round(d/60)+"\u5206\u949f\u524d":d<86400?Math.round(d/3600)+"\u5c0f\u65f6\u524d":(c.getFullYear()==b.getFullYear()?"":b.getFullYear()+"\u5e74")+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5"},require:function(a,b){if(typeof a=="string")p.loaded[a]?b():x(p.STATIC+p.libs[a],function(){p.loaded[a]=!0,b()});else if(typeof a=="object"){var c,d=!0;for(c=0;c<a.length;c++)(function(e){if(p.loaded[a[c]])return;d=!1,x(p.STATIC+p.libs[e],function(){p.loaded[e]=!0;for(var c=0;c<a.length;c++)if(!p.loaded[a[c]])return;b()})})(a[c]);d&&b()}},injectStylesheet:function(a){var b=c.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a,d.appendChild(b)},injectStyle:function(a){var b=c.createElement("style");b.type="text/css",a=a.replace(/\}/g,"}\n"),b.styleSheet?b.styleSheet.cssText=a:b.appendChild(c.createTextNode(a)),d.appendChild(b)},init:function(a,b){a&&!q[a]&&(q[a]=b||{type:"EmbedThread"}),p.initView&&p.initView()}},q=p.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentCommentsWidget"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"}},r=p.pagelets={},s=p.jsonData={threads:{},posts:{}},t=p.Collections={},u=p.Views={},v=p.Callbacks={},w=p.openDialog=function(a){return p.dialog!==b&&p.dialog.el.remove(),p.dialog=(new u.Dialog(a)).open()},x=p.injectScript=function(b,e){var f=c.createElement("script");f.type="text/javascript",f.src=b,f.async=!0,f.charset="utf-8",e&&(f.addEventListener?f.addEventListener("load",e,!1):f.attachEvent&&f.attachEvent("onreadystatechange",function(b){var c=b.srcElement.readyState;(c=="loaded"||c=="complete")&&e.call(a)})),d.appendChild(f)},y=p.log=function(a){typeof console=="object"&&console.log(a)},z=p.checkResponse=function(a,b){return function(c){switch(c.code){case 0:a(c,c.response);break;default:b&&b(c),y("\u51fa\u9519\u5566("+c.code+"): "+c.errorMessage),c.errorTrace&&y(c.errorTrace)}}},A=p.smilies={WordPress:{":mrgreen:":"icon_mrgreen.gif",":neutral:":"icon_neutral.gif",":twisted:":"icon_twisted.gif",":arrow:":"icon_arrow.gif",":shock:":"icon_eek.gif",":smile:":"icon_smile.gif",":???:":"icon_confused.gif",":cool:":"icon_cool.gif",":evil:":"icon_evil.gif",":grin:":"icon_biggrin.gif",":idea:":"icon_idea.gif",":oops:":"icon_redface.gif",":razz:":"icon_razz.gif",":roll:":"icon_rolleyes.gif",":wink:":"icon_wink.gif",":cry:":"icon_cry.gif",":eek:":"icon_surprised.gif",":lol:":"icon_lol.gif",":mad:":"icon_mad.gif",":sad:":"icon_sad.gif","8-)":"icon_cool.gif","8-O":"icon_eek.gif",":-(":"icon_sad.gif",":-)":"icon_smile.gif",":-?":"icon_confused.gif",":-D":"icon_biggrin.gif",":-P":"icon_razz.gif",":-o":"icon_surprised.gif",":-x":"icon_mad.gif",":-|":"icon_neutral.gif",";-)":"icon_wink.gif","8)":"icon_cool.gif","8O":"icon_eek.gif",":(":"icon_sad.gif",":)":"icon_smile.gif",":?":"icon_confused.gif",":D":"icon_biggrin.gif",":P":"icon_razz.gif",":o":"icon_surprised.gif",":x":"icon_mad.gif",":|":"icon_neutral.gif",";)":"icon_wink.gif",":!:":"icon_exclaim.gif",":?:":"icon_question.gif"},"\u5fae\u535a-\u9ed8\u8ba4":{"[\u7ec7]":"41/zz2_org.gif","[\u795e\u9a6c]":"60/horse2_org.gif","[\u6d6e\u4e91]":"bc/fuyun_org.gif","[\u7ed9\u529b]":"c9/geili_org.gif","[\u56f4\u89c2]":"f2/wg_org.gif","[\u5a01\u6b66]":"70/vw_org.gif","[\u718a\u732b]":"6e/panda_org.gif","[\u5154\u5b50]":"81/rabbit_org.gif","[\u5965\u7279\u66fc]":"bc/otm_org.gif","[\u56e7]":"15/j_org.gif","[\u4e92\u7c89]":"89/hufen_org.gif","[\u793c\u7269]":"c4/liwu_org.gif","[\u5475\u5475]":"ac/smilea_org.gif","[\u563b\u563b]":"0b/tootha_org.gif","[\u54c8\u54c8]":"6a/laugh.gif","[\u53ef\u7231]":"14/tza_org.gif","[\u53ef\u601c]":"af/kl_org.gif","[\u6316\u9f3b\u5c4e]":"a0/kbsa_org.gif","[\u5403\u60ca]":"f4/cj_org.gif","[\u5bb3\u7f9e]":"6e/shamea_org.gif","[\u6324\u773c]":"c3/zy_org.gif","[\u95ed\u5634]":"29/bz_org.gif","[\u9119\u89c6]":"71/bs2_org.gif","[\u7231\u4f60]":"6d/lovea_org.gif","[\u6cea]":"9d/sada_org.gif","[\u5077\u7b11]":"19/heia_org.gif","[\u4eb2\u4eb2]":"8f/qq_org.gif","[\u751f\u75c5]":"b6/sb_org.gif","[\u592a\u5f00\u5fc3]":"58/mb_org.gif","[\u61d2\u5f97\u7406\u4f60]":"17/ldln_org.gif","[\u53f3\u54fc\u54fc]":"98/yhh_org.gif","[\u5de6\u54fc\u54fc]":"6d/zhh_org.gif","[\u5618]":"a6/x_org.gif","[\u8870]":"af/cry.gif","[\u59d4\u5c48]":"73/wq_org.gif","[\u5410]":"9e/t_org.gif","[\u6253\u54c8\u6c14]":"f3/k_org.gif","[\u62b1\u62b1]":"27/bba_org.gif","[\u6012]":"7c/angrya_org.gif","[\u7591\u95ee]":"5c/yw_org.gif","[\u998b\u5634]":"a5/cza_org.gif","[\u62dc\u62dc]":"70/88_org.gif","[\u601d\u8003]":"e9/sk_org.gif","[\u6c57]":"24/sweata_org.gif","[\u56f0]":"7f/sleepya_org.gif","[\u7761\u89c9]":"6b/sleepa_org.gif","[\u94b1]":"90/money_org.gif","[\u5931\u671b]":"0c/sw_org.gif","[\u9177]":"40/cool_org.gif","[\u82b1\u5fc3]":"8c/hsa_org.gif","[\u54fc]":"49/hatea_org.gif","[\u9f13\u638c]":"36/gza_org.gif","[\u6655]":"d9/dizzya_org.gif","[\u60b2\u4f24]":"1a/bs_org.gif","[\u6293\u72c2]":"62/crazya_org.gif","[\u9ed1\u7ebf]":"91/h_org.gif","[\u9634\u9669]":"6d/yx_org.gif","[\u6012\u9a82]":"89/nm_org.gif","[\u5fc3]":"40/hearta_org.gif","[\u4f24\u5fc3]":"ea/unheart.gif","[\u732a\u5934]":"58/pig.gif","[ok]":"d6/ok_org.gif","[\u8036]":"d9/ye_org.gif","[good]":"d8/good_org.gif","[\u4e0d\u8981]":"c7/no_org.gif","[\u8d5e]":"d0/z2_org.gif","[\u6765]":"40/come_org.gif","[\u5f31]":"d8/sad_org.gif","[\u8721\u70db]":"91/lazu_org.gif","[\u949f]":"d3/clock_org.gif","[\u86cb\u7cd5]":"6a/cake.gif","[\u8bdd\u7b52]":"1b/m_org.gif","[\u56f4\u8116]":"3f/weijin_org.gif","[\u8f6c\u53d1]":"02/lxhzhuanfa_org.gif","[\u8def\u8fc7\u8fd9\u513f]":"ac/lxhluguo_org.gif","[bofu\u53d8\u8138]":"bb/bofubianlian_org.gif","[gbz\u56f0]":"f5/gbzkun_org.gif","[\u751f\u95f7\u6c14]":"47/boboshengmenqi_org.gif","[\u4e0d\u8981\u554a]":"5e/chn_buyaoya_org.gif","[dx\u6cea\u5954]":"ca/daxiongleibenxiong_org.gif","[\u8fd0\u6c14\u4e2d]":"c3/cat_yunqizhong_org.gif","[\u6709\u94b1]":"e6/youqian_org.gif","[\u51b2\u950b]":"2f/cf_org.gif","[\u7167\u76f8\u673a]":"33/camera_org.gif"}},B=["EmbedThread","RecentCommentsWidget","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"],C=0,D=p.templates={userAnchor:function(a){return a.url?'<a rel="author" target="_blank" href="'+k(a.url)+'">'+k(a.name)+"</a>":k(a.name)},authorAnchor:function(a){var b=a.author_name||a.author.name,c=a.author_url||a.author.url;return c?'<a rel="author" target="_blank" href="'+k(c)+'">'+k(b)+"</a>":k(b)},avatar:function(a,b){return'<img src="'+k(a&&a.avatar_url||J.data.default_avatar_url)+'" '+(b?'width="'+b+'" height="'+b+'" ':"")+(a.user_id?'data-user-id="'+a.user_id+'" ':"")+"/>"},timeHtml:function(a,b){return a?b?'<a href="'+b+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+a+'" title="'+p.fullTime(a)+'">'+p.elapsedTime(a)+"</a>":'<span class="ds-time" datetime="'+a+'" title="'+p.fullTime(a)+'">'+p.elapsedTime(a)+"</span>":""},serviceIcon:function(a,b){return'<span class="ds-connected-sites"><a href="javascript:void(0)" class="ds-service-icon ds-'+a+(b?" ds-"+a+"-active":"")+'" data-service="'+a+'" title="'+p.sourceName[a]+'"></a></span>'},loginButtons:function(a){return'<div class="ds-login-buttons"><div class="ds-border-highlight"></div><p>\u4f7f\u7528\u793e\u4ea4\u5e10\u53f7\u767b\u5f55:</p>'+D.serviceList()+D.additionalServices()+"</div>"},copyRights:[function(a){return k(a.name)+"\u6b63\u5728\u4f7f\u7528\u591a\u8bf4"},o("\u591a\u8bf4"),o("Powered by \u591a\u8bf4"),o("\u591a\u8bf4\u5f3a\u529b\u9a71\u52a8")],poweredBy:function(a){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+D.copyRights[a.copyright_template](a)+"</a></p>"},indicator:o('<div id="ds-indicator"><img src="'+p.STATIC+'/images/loading.gif"/></div>'),waitingImg:o(a.XMLHttpRequest?'<img width="16" height="11" alt="..." src="data:image/gif;base64,R0lGODlhEAALAPQAAP///z2LqeLt8dvp7u7090GNqz2LqV+fuJ/F1IW2ycrf51aatHWswaXJ14i4ys3h6FmctUCMqniuw+vz9eHs8fb5+meku+Tu8vT4+cfd5bbT3tbm7PH2+AAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA" style="margin:0 0 3px 5px"/>':"..."),serviceList:function(a){return'<ul class="ds-service-list">'+D.loginItem("weibo",a)+D.loginItem("qq",a)+D.loginItem("renren",a)+D.loginItem("douban",a)+D.loginItem("kaixin",a)+'<li><a class="ds-more-services" href="javascript:void(0)">\u66f4\u591a\u00bb</a></li>'+"</ul>"},additionalServices:function(a){return'<ul class="ds-service-list ds-additional-services">'+D.loginItem("taobao",a)+D.loginItem("netease",a)+D.loginItem("sohu",a)+D.loginItem("baidu",a)+D.loginItem("google",a)+"</ul>"},loginItem:function(a,b){var c=D.loginUrl(a,b);return'<li><span class="ds-connected-sites"><a href="'+c+'" rel="nofollow" class="ds-service-icon ds-'+a+" ds-"+a+'-active"></a>'+"</span>"+'<a href="'+c+'" rel="nofollow">'+p.serviceNames[a]+"</a>"+(K.data.connected_services[a]?'<span class="ds-ui-icon"></span>':"")+"</li>"}},E=function(a){return a.author_name||a.author&&a.author.name};for(;C<B.length;C++)p[B[C]]=function(a){return function(b,c){c=c||{},c.type=a,b&&!q[b]&&(q[b]=c),p.initSelector&&p.initSelector(b,c)}}(B[C]);var F=0,G=p.Class=function(){};G.extend=function(a){function d(){!F&&this.init&&this.init.apply(this,arguments)}F=1;var b=new this;F=0;for(var c in a)b[c]=a[c];return d.prototype=b,d.prototype.constructor=d,d.extend=arguments.callee,d};var H=p.Model=G.extend({init:function(a){this.handlers={},this.data=a},reset:function(a){this.data=a,this.trigger("reset")},remove:function(a){this.data.splice(a,1),this.trigger("reset")},on:function(a,c){return this.handlers[a]===b&&(this.handlers[a]=[]),this.handlers[a].push(c),this},trigger:function(a,b){var c=this.handlers[a];if(c)for(var d=0;d<c.length;d++)if(c[d].call(this,b)===!1)break;return this},set:function(a,c){if(c===b)for(var d in a)this.data[d]=a[d];else this.data[a]=c;this.trigger("reset")}}),I=p.threads={},J=p.site=new H,K=p.visitor=new H,L=p.unreadComments=new H,M=p.unreadNotifications=new H,N=p.parentPosts=new H({});p.loaded.jQuery&&(p.jQuery=a.jQuery),p.require("jQuery",function(){function O(){F=setTimeout(function(){F&&C.fadeOut(100)},350)}function Q(){return{referer:c.referrer,require:P++?"site,visitor,serverTime":"site,visitor,serverTime,unreadComments,unreadNotifications,log,extraCss"}}function R(){var b=a.duoshuoQuery;if(!b)return!1;p.hostUrl=b.short_name?"http://"+b.short_name+"."+p.DOMAIN:p.REMOTE}var d=p.jQuery,e=d(a),f=d(c),h=a.console||{log:d.noop},o=p.post=function(b,c,e,f){var g=a.duoshuoQuery;return c.short_name=g.short_name,g.remote_auth&&(c.remote_auth=g.remote_auth),p.xhr.request({url:b,method:"POST",data:c},function(a){try{var b=easyXDM.getJSONObject().parse(a.data);z(e,f)(b)}catch(c){}},f||d.noop)},s=p.ajaxJsonp=function(c,e,f,h){var i=a.duoshuoQuery;if(d.isFunction(f)){var j="cb_"+Math.round(Math.random()*1e6);p[j]=z(f,h),f="DUOSHUO['"+j+"']"}var k="?callback="+g(f);i.remote_auth&&(e.remote_auth=i.remote_auth),d.each(e,function(a,c){c!=b&&(k+="&"+a+"="+g(c))}),x(p.hostUrl+c+k)},v=p.loadRequire=function(a){a.serverTime&&(i=(new Date).getTime()-a.serverTime*1e3),a.visitor&&K.reset(a.visitor),a.site&&J.reset(a.site);if(a.stylesheets)for(var b=0;b<a.stylesheets.length;b++)p.injectStylesheet(a.stylesheets[b]);a.style&&p.injectStyle(a.style),a.unreadComments&&L.reset(a.unreadComments),a.unreadNotifications&&M.reset(a.unreadNotifications)};d.extend(D,{loginUrl:function(a,b){var c=p.hostUrl+(b?"/bind/":"/login/")+a+"/";return duoshuoQuery.sso&&duoshuoQuery.sso.login&&(c+="?sso=1&redirect_uri="+g(duoshuoQuery.sso.login)),c},logoutUrl:function(){var a=p.hostUrl+"/logout/";return duoshuoQuery.sso&&duoshuoQuery.sso.logout&&(a+="?sso=1&redirect_uri="+g(duoshuoQuery.sso.logout)),a}}),p.scrollTo=function(a){var b=a.offset().top+a.height()-e.height();b>e.scrollTop()&&d("html, body").animate({scrollTop:b},200,"swing")},p.toJSON=function(a){var b=/\r?\n/g,c=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,e=/^(?:select|textarea)/i,f=a.map(function(){return this.elements?d.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||e.test(this.nodeName)||c.test(this.type))}).map(function(a,c){var e=d(this).val();return e==null?null:d.isArray(e)?d.map(e,function(a,d){return{name:c.name,value:a.replace(b,"\r\n")}}):{name:c.name,value:e.replace(b,"\r\n")}}).toArray(),g={};return d.each(f,function(){g[this.name]=this.value}),g};var B=p.Widget=G.extend({init:function(a,b){this.el=a,this.options=b||{},this.render()},render:function(){},reset:function(){},load:function(a){switch(a.code){case 0:v(a),this.onload(a);break;default:this.onError(a)}},onload:function(a){this.el.html(D[this.template].call(D,a.response,d.extend(this.options,a.options)))},onError:function(a){y("\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage),a.errorTrace&&y(a.errorTrace)}});p.resetNotify=function(){var a=d("#ds-notify"),b=L.data?L.data.length:0,e=M.data?M.data.length:0;a.length===0&&(a=d('<div id="ds-notify"></div>').addClass("ds-"+J.data.notify_position).delegate("a.ds-notify-unread-comments","click",p.unreadCommentsDialog).delegate("a.ds-notify-unread-notifications","click",p.unreadNotificationsDialog).appendTo(c.body)),b+e?a.html('<a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="\u591a\u8bf4"></a><ul class="ds-notify-unread"><li><a class="ds-notify-unread-comments" href="javascript:void(0);"'+(b?"":' style="display:none;"')+">\u4f60\u6709"+b+"\u6761\u65b0\u56de\u590d</a></li>"+'<li><a class="ds-notify-unread-notifications" href="javascript:void(0);"'+(e?"":' style="display:none;"')+">\u4f60\u6709"+e+"\u6761\u7cfb\u7edf\u6d88\u606f</a></li>"+"</ul>").show():a.hide()},L.on("reset",p.resetNotify),M.on("reset",p.resetNotify),D.replybox=function(a,b){var c=K.data,d=[],e="",f;for(var g in c.repostOptions)c.repostOptions[g]&&(d.push(g),f=1),e+=D.serviceIcon(g,c.repostOptions[g]);return'<div class="ds-replybox"><form method="post" action="" onsubmit="return false;"><input type="hidden" name="thread_id" value="'+a+'" />'+'<input type="hidden" name="parent_id" value="" />'+(c.user_id?"":'<input type="hidden" name="author_name" value="'+k(c.name)+'" /><input type="hidden" name="author_email" value="'+k(c.email)+'" /><input type="hidden" name="author_url" value="'+k(c.url)+'" />')+'<div class="ds-replybox-main">'+'<div class="ds-textarea-wrapper">'+'<textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="\u8bf4\u70b9\u4ec0\u4e48\u5427 ..."></textarea>'+'<pre class="ds-hidden-text"></pre>'+"</div>"+'<div class="ds-post-toolbar">'+'<div class="ds-post-options">'+(c.user_id?e?'<span class="ds-sync"><input id="ds-sync-checkbox'+(b?"-inline":"")+'" type="checkbox" name="repost" '+(f?'checked="checked" ':"")+'value="'+d.join(",")+'"> <label for="ds-sync-checkbox'+(b?"-inline":"")+'">\u540c\u65f6\u5206\u4eab\u5230:</label> '+e+"</span>":"":J.data.deny_anonymous?"":'<span class="ds-sync" style="color: #999;">\u4e0d\u60f3\u767b\u5f55\uff1f\u76f4\u63a5\u70b9\u51fb\u53d1\u5e03\u5373\u53ef\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00\u3002</span>')+"</div>"+'<button class="ds-post-button" type="submit">\u53d1 \u5e03</button>'+'<div class="ds-toolbar-buttons">'+(J.data.use_smilies?'<a class="ds-toolbar-button ds-add-emote" title="\u63d2\u5165\u8868\u60c5"></a>':"")+(J.data.use_images?'<a class="ds-toolbar-button ds-add-image" title="\u63d2\u5165\u56fe\u7247"></a>':"")+"</div>"+"</div>"+"</div>"+"</form>"+"</div>"},u.Replybox=function(a){this.embedThread=a},u.Replybox.prototype={render:function(a){function y(a){a.data("submitting",!0),a.find(".ds-post-button").addClass("ds-waiting").html("\u6b63\u5728\u53d1\u5e03")[0].disabled=!0}function z(a){a.data("submitting",!1),a.find(".ds-post-button").removeClass("ds-waiting").html("\u53d1 \u5e03")[0].disabled=!1}var b=this,f=b.embedThread,g=function(a){p.loaded.smilies||(x(p.STATIC+"/js/smilies.js"),p.loaded.smilies=!0)},h=b.el=d(D.replybox(f.threadId,a)).click(g),i=h.find("form"),j=i.find("input[type=checkbox]")[0],k=i.find("span.ds-connected-sites a"),q=h.find("pre.ds-hidden-text"),r=i.find("textarea").focus(g).keyup(function(a){if(a.ctrlKey&&a.which==13||a.which==10)i.data("submitting")||i.trigger("submit");n(this)}).keyup(function(a){q.text(this.value),d(this).height(Math.max(54,q.height()+27)),n(this)}).focus(function(){n(this)}).mousedown(function(){n(this)}).mouseup(function(){n(this)}),s=h.find(".ds-add-emote").click(function(a){var e=p.smiliesTooltip;if(s.toggleClass("ds-expanded").hasClass("ds-expanded")){e||(e=p.smiliesTooltip=new u.SmiliesTooltip,e.render().reset("\u5fae\u535a-\u9ed8\u8ba4")),e.replybox=b;var f=b.el.offset();e.el.appendTo(c.body).css({top:f.top+b.el.outerHeight()+5+"px",left:f.left+"px"}).show(),d(c.body).click(v),g(a)}else v(a);return!1}),t=h.find(".ds-add-image").click(function(a){var b=r[0],d=b.value,e="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740",f='<img src="'+e+'" />';if(c.selection){b.value=d.substring(0,l.start)+f+d.substring(l.end,d.length),b.value=b.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),b.focus();var g=c.selection.createRange();g.collapse(),g.findText(e),g.select()}else{b.value=d.substring(0,b.selectionStart)+f+d.substring(b.selectionEnd);var h=b.value.search(e);b.setSelectionRange(h,h+e.length),b.focus()}a.preventDefault()}),v=b.hideSmilies=function(a){s.removeClass("ds-expanded"),p.smiliesTooltip.el.hide(),d(c.body).unbind("click",v)};J.data.deny_anonymous&&r.focus(function(a){if(!K.data.user_id){p.anonymousDialog(i,A);var b=function(a){a.stopPropagation(),r.unbind("click",b)};r.click(b)}return!1});if(!p.support.placeholder){var w=r.attr("placeholder");r.val(w).focus(function(){this.value===w&&(this.value="")}).blur(function(){this.value===""&&(this.value=w)})}var A=function(){y(i),o("/api/posts/create.json",p.toJSON(d(i)),function(a,c){var g=f.options.order=="asc",j=f.options.formPosition=="top",k=d(D.postWithChildren(c));N.set(c.post_id,c),k=k.hide()[g?"appendTo":"prependTo"](b.postList);var l=k.find(".ds-post-color").show();k.slideDown(function(){l.delay(1e3).fadeOut(200)}),j==g&&e.scrollTop(k.offset().top-200);var n=f.el.find(".ds-comments-tab-duoshuo span.ds-highlight");n.html(parseInt(n.html())+1),r.val("").height(54),z(i),h.hasClass("ds-inline-replybox")&&(h.hide(),b.replyButton.removeClass("ds-reply-active")),m("D")&&localStorage.removeItem("messageTempContent"+f.threadId)},function(a){z(i)})};i.submit(function(a){var b=d.trim(i[0].message.value);return b==""||!p.support.placeholder&&b==r.attr("placeholder")?(alert("\u60a8\u8fd8\u6ca1\u5199\u5185\u5bb9\u5462"),!1):(K.data.user_id==0?p.anonymousDialog(i,A):A(),!1)});var B=function(a){var b=d(a).attr("data-service");return d(a).hasClass("ds-"+b+"-active")?b:null};return k.click(function(){var a=d(this);return service=a.attr("data-service"),a.toggleClass("ds-"+service+"-active"),j.value=d.map(k,B).join(","),j.checked=j.value!="",!1}),d(j).change(function(){var a=this.checked;k.each(function(){d(this)[a?"addClass":"removeClass"]("ds-"+d(this).attr("data-service")+"-active")}),this.value=d.map(k,B).join(",")}),this}},u.Dialog=function(a,c){var e=this;e.options=d.extend({width:600},c),e.el=d("#ds-wrapper"),e.el.length==0&&(e.el=d('<div id="ds-wrapper"></div>'),d.browser.msie&&(e.el.addClass("ds-ie"),d.browser.version<7&&e.el.addClass("ds-ie6"))),a!==b&&(d(a).attr("id","ds-reset").appendTo(e.el),e.el.find("a.ds-dialog-close").click(function(a){return e.close(),!1}))},u.Dialog.prototype={open:function(){var a=this;this.el.hide().appendTo(c.body).fadeIn(200),d.browser.msie&&d.browser.version<7&&(this.el.css("top",e.scrollTop()+100),d(".ds-thread select.ds-sort").css("visibility","hidden")),this.el.show().find(".ds-dialog").click(function(a){a.stopPropagation()});var b=function(b){if(b.which==27)return a.close(),!1},g=function(b){return a.close(),!1};return f.keydown(b),d(c.body).click(g),a.close=function(e){f.unbind("keydown",b),d(c.body).unbind("click",g),a.el.fadeOut(200,function(){d(this).remove(),d.browser.msie&&d.browser.version<7&&d(".ds-thread select.ds-sort").css("visibility","visible")})},a},setBody:function(a){this.el.find(".ds-dialog-body").html(a)},setFooter:function(a){this.el.find(".ds-dialog-footer").html(a)}},D.likePanel=function(a){return a.likes?'<span class="ds-highlight">'+a.likes+"</span> \u4eba\u559c\u6b22":""},D.likeTooltip=function(){var a={qzone:"QQ\u7a7a\u95f4",weibo:"\u65b0\u6d6a\u5fae\u535a",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",kaixin:"\u5f00\u5fc3\u7f51",douban:"\u8c46\u74e3\u7f51",baidu:"\u767e\u5ea6\u641c\u85cf",netease:"\u7f51\u6613\u5fae\u535a",sohu:"\u641c\u72d0\u5fae\u535a"},b=[];d.each(a,function(a,c){b.push('<li><a class="ds-share-to-'+a+" ds-service-link ds-"+a+'-active" href="javascript:void(0)">'+c+"</a></li>")});var c=Math.ceil(b.length/2);return'<div class="ds-like-tooltip"><p>\u5f88\u9ad8\u5174\u4f60\u80fd\u559c\u6b22\uff0c\u5206\u4eab\u4e00\u4e0b\u5427\uff1a</p><ul>'+b.slice(0,c).join("")+"</ul>"+"<ul>"+b.slice(c).join("")+"</ul>"+'<p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">\u7b97\u4e86</a></p>'+"</div>"},u.Meta=function(a){this.embedThread=a},u.Meta.prototype={render:function(){var e=this,f=e.embedThread,g=f.data,h=e.el=d('<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button'+(g.user_vote>0?" ds-thread-liked":"")+'"><span class="ds-ui-icon"></span>'+' <span class="ds-thread-like-text">'+(g.user_vote>0?"\u5df2\u559c\u6b22":"\u559c\u6b22")+'</span><span class="ds-thread-cancel-like">\u53d6\u6d88\u559c\u6b22</span></a>'+'<span class="ds-like-panel"></span>'+"</div>"),i=h.find(".ds-like-thread-button").click(function(j){var k=i.hasClass("ds-thread-liked");o("/api/threads/vote.json",{thread_id:f.threadId,vote:k?0:1},function(a){d.each(a.thread,function(a,b){g[a]=b}),e.resetLikePanel()}),i.toggleClass("ds-thread-liked"),i.find(".ds-thread-like-text").text(k?"\u559c\u6b22":"\u5df2\u559c\u6b22");var l=function(a){e.tooltip.detach(),d(c.body).unbind("click",l)};return k?e.tooltip&&l(j):(e.tooltip===b&&(e.tooltip=d(D.likeTooltip(g)).click(function(a){a.stopPropagation()}).delegate("a","click",function(b){switch(this.className){case"ds-like-tooltip-close":l(b);break;default:var c=this.className.match(/ds\-share\-to\-(\w+)/)[1];a.open("http://"+J.data.short_name+"."+p.DOMAIN+"/share-proxy/?service="+c+"&thread_id="+f.threadId,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no")}return!1})),e.tooltip.appendTo(f.innerEl).css({top:h.position().top+h.outerHeight()-4+"px",left:0}).show(),d(c.body).click(l)),!1});return e.resetLikePanel(),K.data.user_id||h.hide(),e},resetLikePanel:function(){this.el.find(".ds-like-panel").html(D.likePanel(this.embedThread.data))}},D.postListHead=function(a){return'<div class="ds-comments-info"><select class="ds-sort"><option value="desc">\u4ece\u65b0\u5230\u65e7\u6392\u5e8f</option><option value="asc">\u4ece\u65e7\u5230\u65b0\u6392\u5e8f</option></select><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"><span class="ds-highlight">'+a.comments+"</span>\u6761\u8bc4\u8bba</a></li>"+(J.data.show_reposts&&a.reposts?'<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"><span class="ds-highlight">'+a.reposts+"</span>\u6761\u8f6c\u8f7d</a></li>":"")+(J.data.show_weibo&&a.weibo_reposts?'<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"><span class="ds-highlight">'+a.weibo_reposts+"</span>\u6761\u65b0\u6d6a\u5fae\u535a</a></li>":"")+(J.data.show_qqt&&a.qqt_reposts?'<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"><span class="ds-highlight">'+a.qqt_reposts+"</span>\u6761\u817e\u8baf\u5fae\u535a</a></li>":"")+"</ul>"+"</div>"},u.PostListHead=function(a,b){this.embedThread=a,this.options=b},u.PostListHead.prototype={render:function(){var a=this.options,b=this.embedThread,c=b.postList,e=this.el=d(D.postListHead(a.thread)),f=e.find("ul.ds-comments-tabs").delegate(".ds-tab a","click",function(a){f.find("a.ds-current").removeClass("ds-current"),c.params.page=1;var e=a.currentTarget;switch(e.className){case"ds-comments-tab-duoshuo":c.params.source="duoshuo",b.replybox.el.show();break;case"ds-comments-tab-repost":c.params.source="repost",b.replybox.el.hide();break;case"ds-comments-tab-weibo":c.params.source="weibo",b.replybox.el.hide();break;case"ds-comments-tab-qqt":c.params.source="qqt",b.replybox.el.hide();break;default:}return d(e).addClass("ds-current"),c.refetch(),!1});e.find("select").val(a.order).change(function(a){c.params.order=b.options.order=this.value,c.refetch()})}},u.Paginator=function(a){a&&(this.el=a.el||d('<div class="ds-paginator"></div>'),a.collection&&(this.collection=a.collection))},u.Paginator.prototype={reset:function(a){function e(a){d.push('<a data-page="'+a+'" href="javascript:void(0);">'+a+"</a>")}var b=this.collection.params.page||1,c,d=[];if(b>1){e(1),c=b>4?b-2:2,c>2&&d.push('<span class="page-break">...</span>');for(;c<b;c++)e(c)}d.push('<a data-page="'+b+'" href="javascript:void(0);" class="ds-current">'+b+"</a>");if(b<a.pages){for(c=b+1;c<=b+4&&c<a.pages;c++)e(c);c<a.pages&&d.push('<span class="page-break">...</span>'),e(a.pages)}this.el.html('<div class="ds-border"></div>'+d.join(" ")),this.el[a.pages>1?"show":"hide"]()},render:function(){var a=this,b=a.collection;return this.el.delegate("a","click",function(c){return b.params.page=parseInt(this.innerHTML),b.refetch(),a.el.find(".ds-current").removeClass("ds-current"),d(this).addClass("ds-current"),!1}),this}},D.smiliesTooltip=function(){var a='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';return d.each(A,function(b,c){a+="<li><a>"+b+"</a></li>"}),a+"</ul>"+'<div class="ds-smilies-container"></div>'+"</div>"},p.addSmilies=function(a,b){var c=p.smiliesTooltip;c&&c.el.find("ul.ds-smilies-tabs").append("<li><a>"+a+"</a></li>"),p.smilies[a]=b},u.SmiliesTooltip=function(){},u.SmiliesTooltip.prototype={render:function(){var a=this,b=a.el=d(D.smiliesTooltip());return b.click(function(a){a.stopPropagation()}).find("ul.ds-smilies-tabs").delegate("a","click",function(b){a.reset(this.innerHTML)}),b.find(".ds-smilies-container").delegate("img","click",function(b){var d=a.replybox,e=d.el.find("textarea")[0],f=e.value;if(c.selection){e.value=f.substring(0,l.start)+this.title+f.substring(l.end,f.length),e.value=e.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),e.focus();var g=c.selection.createRange();g.moveStart("character",l.start+this.title.length),g.collapse(),g.select()}else{var h=e.selectionStart+this.title.length;e.value=f.substring(0,e.selectionStart)+this.title+f.substring(e.selectionEnd),e.setSelectionRange(h,h)}d.hideSmilies(),e.focus()}),this},reset:function(a){var b=this.el.find("ul.ds-smilies-tabs");b.find("a.ds-current").removeClass("ds-current"),b.find("a").filter(function(){return this.innerHTML==a}).addClass("ds-current");var c='<ul style="">';return d.each(A[a],function(b,d){var e;a.indexOf("\u5fae\u535a")===0?e="http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+d.replace("_org","_thumb"):e=p.STATIC+"/images/smilies/"+d,a==="WordPress"&&(b=" "+b+" "),c+='<li><img src="'+e+'" title="'+k(b)+'" /></li>'}),c+="</ul>",this.el.find(".ds-smilies-container").html(c),this}},D.ctxPost=function(a,b){return'<li class="ds-ctx-entry"><div class="ds-avatar">'+D.avatar(a.author)+"</div>"+'<div class="ds-ctx-content"><p>'+D.authorAnchor(a)+D.timeHtml(a.created_at,a.url)+"</p>"+"<p>"+a.message+"</p></div>"+'<div style="clear:both"></div>'+"</li>"};var C=d('<div id="ds-ctx-bubble"><ul></ul><div><a class="ds-ctx-open" href="javascript:void(0);">\u67e5\u770b\u5bf9\u8bdd</a></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>').delegate("a.ds-ctx-open","click",function(b){b.stopPropagation(),s("/api/posts/conversation.jsonp",{post_id:C.attr("data-post-id")},function(a,b){c.el.find("ul").html(d.map(b,function(a){return D.ctxPost(a,!0)}).join("\n"))});var c=w('<div class="ds-dialog" style="width:600px;"><div class="ds-dialog-inner"><div class="ds-dialog-header"><h2>\u67e5\u770b\u5bf9\u8bdd</h2><a class="ds-dialog-close" style="top:15px" href="javascript:void(0);"></a></div><div class="ds-dialog-body" style="'+(a.XMLHttpRequest?"max-height":"height")+':350px;overflow-y:auto;padding-top:10px">'+'<ul><li style="text-align:center">'+D.waitingImg()+"</li></ul>"+"</div>"+"</div>"+"</div>")}),F=0;C.hover(function(){clearTimeout(F),F=0},O),D.post=function(a){var b=a.author,c=a.author_url||b&&b.url;return'<div class="ds-post-self'+(a.vote>0?" ds-post-liked":"")+'" data-post-id="'+a.post_id+'" data-thread-id="'+a.thread_id+'">'+'<div class="ds-post-color"></div>'+'<div class="ds-post-main">'+'<div class="ds-avatar">'+(c?'<a href="'+k(c)+'" rel="nofollow" target="_blank">'+D.avatar(b)+"</a>":D.avatar(b))+(p.sourceName[a.source]?D.serviceIcon(a.source,1):"")+"</div>"+'<div class="ds-comment-body">'+'<div class="ds-comment-header">'+(c?'<a class="ds-user-name ds-highlight" href="'+
k(c)+'" rel="nofollow" target="_blank">'+k(E(a))+"</a>":'<span class="ds-user-name">'+k(E(a))+"</span>")+"</div>"+"<p>"+(a.parent_id&&N.data[a.parent_id]?'<a class="ds-comment-context" data-post-id="'+a.post_id+'" data-parent-id="'+a.parent_id+'"><span class="ds-ui-icon"></span>\u56de\u590d '+k(E(N.data[a.parent_id]))+": </a>":"")+a.message+"</p>"+'<div class="ds-comment-footer">'+D.timeHtml(a.created_at,a.url)+(a.source!="weibo"&&a.source!="qqt"?'<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-ui-icon"></span>\u56de\u590d</a>':"")+(a.source!="weibo"&&a.source!="qqt"&&K.data.user_id?'<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-post-like"><span class="ds-ui-icon"></span></span><span class="ds-post-unlike"><span class="ds-ui-icon"></span></span> \u8d5e <span class="ds-post-like-count">'+(a.likes>0?a.likes:"")+"</span></a>":"")+(a.source!="weibo"&&a.source!="qqt"?' <a class="ds-post-report" href="javascript:void(0);"><span class="ds-ui-icon"></span> \u4e3e\u62a5</a>':"")+(a.source!="weibo"&&a.source!="qqt"&&a.privileges["delete"]?' <a class="ds-post-delete" href="javascript:void(0);"><span class="ds-ui-icon"></span> \u5220\u9664</a>':"")+"</div>"+"</div>"+"</div>"+"</div>"},D.postWithChildren=function(a){var b='<li class="ds-post" data-post-id="'+a.post_id+'">'+D.post(a);return a.children&&(b+='<div class="ds-children-wrapper"><div class="ds-children-control"><a class="ds-collapse"><span class="ds-ui-icon"></span></a><a class="ds-expand"></a></div><div class="ds-collapse-padding"></div><ul class="ds-children">'+d.map(a.children,D.postWithChildren).join("")+"</ul>"+"</div>"),b+"</li>"},t.PostList=function(a){a&&(a.params&&(this.params=a.params),a.embedThread&&(this.embedThread=a.embedThread)),this.el=d('<ul class="ds-comments"></ul>')},t.PostList.prototype={url:"/api/posts/list",render:function(){var a=this.embedThread;return this.el.delegate("a.ds-post-likes","click",function(a){var b=d(this).parents(".ds-post-self"),c=d(this).find(".ds-post-like-count"),e=b.hasClass("ds-post-liked");return o("/api/posts/vote.json",{post_id:b.attr("data-post-id"),vote:e?0:1},d.noop),c.html((c.html()==""?0:parseInt(c.html()))+(e?-1:1)),b[e?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-comment-context","mouseenter",function(){F&&(clearTimeout(F),F=0);var b=d(this),c=b.offset(),e=a.el.offset(),f=a.el.height()-(c.top-e.top)+10,g=c.left-e.left,h=N.data[b.attr("data-parent-id")];C.attr("data-post-id",b.attr("data-post-id")).find("ul").html(D.ctxPost(h)),C.appendTo(a.innerEl).stop().css({bottom:f,left:g,opacity:1}).show()}).delegate("a.ds-comment-context","mouseleave",O).delegate("a.ds-post-delete","click",function(b){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var c=d(this).parents(".ds-post-self");o("/api/posts/remove.json",{post_id:c.attr("data-post-id")},d.noop),c.parent().fadeOut(200,function(){var b=d(this).parent(".ds-children"),c=a.el.find(".ds-comments-tab-duoshuo span.ds-highlight");b.children("li:visible").length<1&&b.siblings(".ds-children-control, .ds-collapse-padding").remove(),c.html(parseInt(c.html())-Math.max(b.find(".ds-post-self").length,1)),d(this).remove()})}return!1}).delegate("a.ds-post-report","click",function(a){if(confirm("\u786e\u5b9a\u8981\u4e3e\u62a5\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var b=d(this).parents(".ds-post-self");o("/api/posts/report.json",{post_id:b.attr("data-post-id")},d.noop),alert("\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01")}return!1}).delegate("a.ds-post-reply","click",function(b){var c=a.inlineReplybox;if(d(this).hasClass("ds-reply-active"))c.el.fadeOut(200,function(){d(this).hide()}),d(this).removeClass("ds-reply-active");else{var e=d(this).parents(".ds-post-self"),f=e.siblings("ul.ds-children");f.length==0&&(f=d('<ul class="ds-children"></ul>').insertAfter(e)),c?c.replyButton.removeClass("ds-reply-active"):(c=a.inlineReplybox=new u.Replybox(a),c.render(!0).el.addClass("ds-inline-replybox").hide()),c.postList=J.data.max_depth<=1?a.postList.el:f,c.replyButton=d(this).addClass("ds-reply-active"),c.el.find("[name=parent_id]").val(e.attr("data-post-id")),c.el[a.options.order=="asc"?"insertAfter":"insertBefore"](f).fadeIn(200).find("textarea").focus()}return!1}).delegate("div.ds-children-control","click",function(a){var b=d(this).parent().toggleClass("ds-collapsed");d(this).children(".ds-expand").html('<span class="ds-ui-icon"></span>\u5c55\u5f00'+b.find(".ds-post-self").length+"\u6761\u56de\u590d")}),this},reset:function(a){this.el.html(d.map(a,D.postWithChildren).join(""))},refetch:function(){var a=this,b=d("#ds-indicator").fadeIn(200);a.el.fadeTo(200,.5),s(a.url+".jsonp",a.params,function(c,d){N.set(c.parentPosts),a.reset(d),a.embedThread.paginator.reset(c.cursor),b.fadeOut(200),a.el.fadeTo(200,1)})}},p.anonymousDialog=function(a,b){var c=a[0].author_email.value,d=a[0].author_name.value,e=a[0].author_url.value,f=w('<div class="ds-dialog '+(J.data.deny_anonymous?"ds-dialog-login-deny-anonymous":"ds-dialog-login")+'">'+'<div class="ds-dialog-inner">'+'<div class="ds-dialog-body">'+'<div class="ds-dialog-left">'+"<h2>\u7528\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2>"+D.serviceList()+D.additionalServices()+"</div>"+(J.data.deny_anonymous?"":'<div class="ds-dialog-right"><h2>\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00</h2><form><div class="ds-input"><input type="text" name="name" id="ds-dialog-name" value="'+d+'" required />'+'<label for="ds-dialog-name">\u540d\u5b57(\u5fc5\u987b)</label>'+"</div>"+'<div class="ds-input">'+'<input type="text" name="email" id="ds-dialog-email" value="'+c+'" required />'+'<label for="ds-dialog-email">\u90ae\u7bb1(\u5fc5\u987b)</label>'+"</div>"+'<div class="ds-input">'+'<input type="text" name="url" id="ds-dialog-url" value="'+(e||"http://")+'" />'+'<label for="ds-dialog-url">\u7f51\u5740(\u53ef\u9009)</label>'+"</div>"+'<button type="submit">\u53d1 \u5e03</button>'+"</form>"+"</div>")+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>");if(!J.data.deny_anonymous){var g=f.el.find("form");g.submit(function(c){var d=g.find("input[name=name]").val(),e=g.find("input[name=email]").val(),h=g.find("input[name=url]").val();return e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(a.find("input[name=author_name]").val(d),a.find("input[name=author_email]").val(e),a.find("input[name=author_url]").val(h),b(),f.close(),!1):(alert("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684email\u5730\u5740."),!1)}),g.find("input[name=name]")[0].focus()}},p.bindMoreAccountDialog=function(){return w('<div class="ds-dialog ds-dialog-bind-more" style="width: 300px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u7ed1\u5b9a\u66f4\u591a\u5e10\u53f7</h2>'+D.serviceList(1)+D.additionalServices(1)+'<div style="clear:both"></div>'+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),!1},p.unreadCommentsDialog=function(){var a=w('<div class="ds-dialog" style="width: 450px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u65b0\u7559\u8a00\u53ca\u56de\u590d</h2><ul class="ds-unread-comments">'+d.map(L.data,function(a){return'<li data-thread-id="'+a.thread.thread_id+'">'+d.map(a.authors,D.userAnchor).join("\u3001")+' \u5728 <a href="'+a.thread.url+'#comments" target="_blank">'+(a.thread.title||"\u65e0\u6807\u9898")+'</a> \u4e2d\u56de\u590d\u4e86\u4f60<a class="ds-delete" title="\u77e5\u9053\u4e86">\u77e5\u9053\u4e86</a></li>'}).join("\n")+"</ul>"+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),b=a.el.find(".ds-unread-comments").delegate(".ds-delete","click",function(c){var e=d(this).parent(),f=e.attr("data-thread-id");o("/api/threads/read.json",{thread_id:f},d.noop),d.each(L.data,function(a,b){b.thread.thread_id==f&&L.remove(a)}),e.remove(),b.children().length===0&&a.close()});return d("#ds-notify .ds-notify-unread-comments").hide(),d("#ds-notify .ds-notify-unread-notifications")[0].style.display=="none"&&d("#ds-notify").hide(),!1},p.unreadNotificationsDialog=function(){var a=w('<div class="ds-dialog" style="width: 450px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u7cfb\u7edf\u6d88\u606f</h2><ul class="ds-unread-notifications">'+d.map(M.data,function(a){return'<li data-notification-id="'+a.notification_id+'" data-notification-type="'+a.type+'">'+a.content+'</a> <a class="ds-delete" title="\u77e5\u9053\u4e86">\u77e5\u9053\u4e86</a></li>'}).join("\n")+"</ul>"+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),b=a.el.find(".ds-unread-notifications").delegate(".ds-delete","click",function(c){var e=d(this).parent(),f=e.data("notification-id");o("/api/notifications/read.json",{notification_id:f},d.noop),d.each(M.data,function(a,b){b.notificationId==f&&M.remove(a)}),e.remove(),b.children().length===0&&a.close()});return d("#ds-notify .ds-notify-unread-notifications").hide(),d("#ds-notify .ds-notify-unread-comments")[0].style.display=="none"&&d("#ds-notify").hide(),!1},D.toolbar=function(a){var b=D.logoutUrl(),c="";return'<div class="ds-toolbar"><div class="ds-border-highlight"></div><div class="ds-visitor"><span class="ds-visitor-avatar"><img src="'+k(K.data.avatar_url)+'"/>'+"</span>"+(K.data.url?'<a class="ds-visitor-name" href="'+k(K.data.url)+'" target="_blank">'+k(K.data.name)+"</a>":'<span class="ds-visitor-name">'+k(K.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="\u65b0\u56de\u590d"></a>'+'<span><a style="vertical-align:baseline" target="_blank" rel="nofollow" href="http://duoshuo.com/settings/'+c+'">\u8bbe\u7f6e</a></span>'+"</div>"+'<div class="ds-account-control">'+'<span class="ds-ui-icon"></span> <span>\u5e10\u53f7\u7ba1\u7406</span>'+"<ul>"+'<li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">\u7ed1\u5b9a\u66f4\u591a</a></li>'+'<li><a target="_blank" href="http://duoshuo.com/settings/'+c+'">\u8bbe\u7f6e</a></li>'+'<li><a rel="nofollow" href="'+b+'" style="border-bottom: none">\u767b\u51fa</a></li>'+"</ul>"+"</div>"+"</div>"},u.EmbedThread=B.extend({uri:"/api/threads/listPosts",params:["thread-id","local-thread-id","source-thread-id","thread-key","author-key","category","limit","order","title","url","form-position","author-id","image","thumbnail","channel-key"],render:function(){var b=this.el;b.attr("id","ds-thread"),!b.attr("data-thread-id")&&!b.data("url")&&b.data("url",d("link[rel=canonical]").attr("href")||a.location.href),this.waitingEl=d('<div class="ds-waiting"></div>').html(D.waitingImg()).appendTo(b)},onError:function(a){this.el.html("\u8bc4\u8bba\u6846\u51fa\u9519\u5566("+a.code+"): "+a.errorMessage)},onload:function(a){var e=this,f=e.threadId=a.thread.thread_id,g=a.cursor,h=e.options=a.options,i=e.innerEl=d('<div id="ds-reset"></div>').appendTo(e.el);e.data=a.thread,p.parentPosts.set(a.parentPosts),e.waitingEl.hide(),h.formPosition=="top"&&i.css("margin-top","15px");if(d.browser.msie){i.addClass("ds-ie");var j=d.browser.version;j<7&&i.addClass("ds-ie6"),j<8&&i.addClass("ds-ie7"),j<9&&i.addClass("ds-ie8")}J.data.like_thread_enabled&&(e.meta=new u.Meta(e),e.meta.render().el.appendTo(i));if(K.data.user_id==0){e.loginButtons=d(D.loginButtons()).appendTo(i);var k=e.loginButtons.find("ul.ds-additional-services");e.loginButtons.find("a.ds-more-services").click(function(){return k.toggle(),!1})}else{var l=e.toolbar=d(D.toolbar()).appendTo(i);l.find(".ds-account-control").hover(function(){d(this).addClass("ds-active")},function(){d(this).removeClass("ds-active")}),l.find("a.ds-bind-more").click(p.bindMoreAccountDialog),l.find("a.ds-unread-comments-count").click(p.unreadCommentsDialog)}var n=e.replybox=new u.Replybox(e);i.append(d('<div style="height:0px;"><a name="respond">&nbsp;</a></div>'),n.render().el),h.message&&n.el.find("textarea").val(h.message).focus(),m("D")&&(d(".ds-replybox-main .ds-textarea-wrapper").find("textarea").live("focus blur keyup",function(a){var b=d(a.currentTarget).val();localStorage["messageTempContent"+f]=b}),localStorage["messageTempContent"+f]&&n.el.find("textarea").val(localStorage["messageTempContent"+f])),e.postListHead=new u.PostListHead(e,{thread:e.data,order:h.order}),e.postList=new t.PostList({embedThread:e,params:{source:"duoshuo",thread_id:f,order:h.order,limit:h.limit}}),e.paginator=new u.Paginator({collection:e.postList}),e.postListHead.render(),e.postList.render().reset(a.response),e.paginator.render().reset(g),n.postList=e.postList.el,h.formPosition=="top"?i.append(e.postListHead.el,e.postList.el,e.paginator.el):(e.loginButtons||l).before(e.postListHead.el,e.postList.el,e.paginator.el),d(D.indicator()).appendTo(c.body),d(D.poweredBy(J.data)).appendTo(i),L.on("reset",function(){var a=L.data.length;i.find("a.ds-unread-comments-count").html(a).attr("title",a?"\u4f60\u6709"+a+"\u6761\u65b0\u56de\u590d":"\u4f60\u6ca1\u6709\u65b0\u56de\u590d").css("display",a?"inline":"none")}),L.data!==b&&L.trigger("reset"),M.data!==b&&M.trigger("reset")}}),D.commentList=function(a,b){return d.map(a,function(a){var c=a.author_url||a.author&&a.author.url;return'<li class="ds-comment'+(b.show_avatars?" ds-show-avatars":"")+'" data-post-id="'+a.post_id+'">'+(b.show_avatars?c?'<a class="ds-avatar" rel="author nofollow" target="_blank" href="'+k(c)+'">'+D.avatar(a.author,b.avatar_size)+"</a>":'<div class="ds-avatar">'+D.avatar(a.author,b.avatar_size)+"</div>":"")+'<div class="ds-meta">'+D.authorAnchor(a)+(b.show_time?D.timeHtml(a.created_at):"")+"</div>"+(b.show_title?'<div class="ds-thread-title">\u5728 <a href="'+k(a.thread.url+"#comments")+'">'+k(a.thread.title)+'</a> \u4e2d\u8bc4\u8bba</div><div class="ds-excerpt">'+a.message+"</div>":'<a class="ds-excerpt" title="'+k(a.thread.title)+' \u4e2d\u7684\u8bc4\u8bba" href="'+k(a.thread.url+"#comments")+'">'+a.message+"</a>")+"</li>"}).join("")},D["comment-list-wordpress"]=function(a,b){return d.map(a,function(a){return'<li class="recentcomments">'+D.authorAnchor(a)+' \u5728 <a href="'+k(a.thread.url+"#comments")+'">'+k(a.thread.title)+"</a> \u4e2d\u8bc4\u8bba</li>"}).join("")},u.RecentCommentsWidget=B.extend({uri:"/api/sites/listRecentPosts",params:["show-avatars","show-time","show-title","avatar-size","show-admin","excerpt-length","num-items","channel-key"],template:"commentList",render:function(){var a=this,b=a.el;this.options.template!=="wordpress"&&b.attr("id","ds-recent-comments")}}),D.recentVisitors=function(a,b){return d.map(a,function(a){return'<div class="ds-avatar">'+(a.url?'<a class="ds-avatar" rel="nofollow" target="_blank" href="'+k(a.url)+'" title="'+a.name+'">'+D.avatar(a,b.avatar_size)+"</a>":D.avatar(a,b.avatar_size))+"</div>"}).join("")},u.RecentVisitors=B.extend({uri:"/api/sites/listVisitors",params:["show-time","avatar-size","num-items","channel-key"],template:"recentVisitors",render:function(){var a=this,b=a.el;b.children().detach(),b.attr("id","ds-recent-visitors"),a.waitingEl=d('<div class="ds-waiting"></div>').appendTo(this.el).html(D.waitingImg())}}),D.topUsersWidget=function(a,b){return d.map(a,function(a){return'<div class="ds-avatar">'+(a.url?'<a class="ds-avatar" rel="nofollow" target="_blank" href="'+k(a.url)+'" title="'+a.name+'">'+D.avatar(a,b.avatar_size)+"</a>":D.avatar(a,b.avatar_size))+"<h4>"+a.name+"</h4>"+"</div>"}).join("")},u.TopUsers=B.extend({uri:"/api/sites/listTopUsers",params:["show-time","avatar-size","num-items","channel-key"],template:"topUsersWidget",render:function(){var a=this,b=a.el;b.children().detach(),b.attr("id","ds-top-users"),a.waitingEl=d('<div class="ds-waiting"></div>').appendTo(this.el).html(D.waitingImg())}}),D.topThreadsWidget=function(a,b){return d.map(a,function(a){return'<li><a target="_blank" href="'+k(a.url)+'" title="'+a.title+'">'+a.title+"</a>"+"</li>"}).join("")},u.TopThreads=B.extend({uri:"/api/sites/listTopThreads",params:["range","num-items","channel-key"],template:"topThreadsWidget",render:function(){var a=this,b=a.el;b.children().detach(),b.attr("id","ds-top-threads"),a.waitingEl=d('<div class="ds-waiting"></div>').appendTo(this.el).html(D.waitingImg())}}),D.loginWidget=function(){var a='<div class="ds-icons-32">';return d.each(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(b,c){a+='<a class="ds-'+c+'" href="javascript:void(0)">'+p.sourceName[c]+"</a>"}),a+"</div>"},u.LoginWidget=B.extend({template:"loginWidget",render:function(){var a=this.el;a.attr("id","ds-login").html(D.loginWidget()),a.find("a").each(function(a,b){var c=b.className.replace("ds-","");if(!p.serviceNames[c])return;b.href=D.loginUrl(c)}),a.find("a.ds-logout").attr("href",D.logoutUrl())},onload:function(){this.el.html(this.template(data,d.extend(this.options,options)))}}),u.ThreadCount=B.extend({onload:function(a){var b=this.el.data("count-type")||"comments",c=a.data[b];this.el[this.el.data("replace")?"replaceWith":"html"](J.data[b+"_"+(c?c>1?"multiple":"one":"zero")].replace("{num}",c))}});var P=0;p.initSelector=function(b,c){var e=[];a.duoshuoQuery&&(d.isReady||!d.browser.msie)&&d(b).each(function(b,f){var g=d(f);if(g.data("initialized"))return;g.data("initialized",!0);var h=r[++j]=new u[c.type](g,c);if(c.type==="ThreadCount"){var i=g.attr("data-thread-key");g.attr("data-channel-key")&&(i=g.attr("data-channel-key")+":"+i),e.push(i),I[i]||(I[i]=new H({})),I[i].on("reset",function(){h.onload(this)})}else if(h.uri){var k=Q();if(a.location.href){var l=a.location.hash,m=a.location.href;k.url=l?m.replace(l,""):m}d.each(h.params,function(a,b){k[b.replace(/-/g,"_")]=g.attr("data-"+b)||g.data(b)}),s(h.uri+".jsonp",k,"DUOSHUO.pagelets["+j+"].load")}});if(e.length){var f=Q();f.threads=e.join(","),s("/api/threads/counts.jsonp",f,function(a){v(a),d.each(a.response,function(a,b){I[a]&&I[a].set(b)})})}},R()||d(R),(p.initView=function(){d.each(q,p.initSelector)})(),d(function(){setInterval(function(){d(".ds-time").each(function(){var a=d(this).attr("datetime");a&&(this.innerHTML=p.elapsedTime(a))})},2e4);var b=a.duoshuoQuery;if(!b){y("\u7f3a\u5c11duoshuoQuery\u7684\u5b9a\u4e49");return}b.ondomready&&b.ondomready(),p.initView();if(!P&&b.short_name){var c=Q();c.url=a.location.href,s("/api/analytics/ping.jsonp",c,v)}})}),p.injectStylesheet(p.STATIC+p.EMBED_STYLESHEET),p.require(["JSON","easyXDM"],function(){p.xhr=new easyXDM.Rpc({swf:p.REMOTE+"/easyxdm.swf",remote:p.REMOTE+"/cors/index.html",remoteHelper:p.REMOTE+"/name.html"},{remote:{request:{}}})})})(window);